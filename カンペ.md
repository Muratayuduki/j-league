【Jリーグ観客動員数予測モデル 発表用カンペ】
発表者：日本工学院 AIシステム科 7班

----------------------------------------------------------------------
【スライド1：表紙】
7班の発表を始めます。
メンバーは村田、渡嘉敷、北原、宮前の4名です。よろしくお願いします。

----------------------------------------------------------------------
【スライド2：目次（研究概要）】
本日の発表の流れです。
まず私たちが行ったのは「CatBoostというモデルの使用」、精度向上のために「ターゲットエンコーディングの導入」、「NHK放送フラグによる補正」の３点です

----------------------------------------------------------------------
【スライド3：中扉（モデル構築）】


----------------------------------------------------------------------
【スライド4：CatBoostの採用理由】
まず、ベースとなる予測モデルについてです。
今回、私たちは「CatBoost」を採用しました。



----------------------------------------------------------------------
【スライド5：モデル構築】

採用した理由は、Jリーグのデータにはチーム名や天候など、数値ではない「カテゴリ変数」が多く含まれているため、これらを効率的に処理できるCatBoostが最適だと判断したからです

----------------------------------------------------------------------
【スライド6：CatBoost適用後の結果】

catboostを使用した前と後のスコアの変化です。
初期モデルではランダムフォレストを使用しておりスコアは4260でした。
次に
CatBoostを使用し、基本的なデータ前処理を行った段階での結果です。
スコアは3969となり、初期モデルから約300ほどの改善しました。

----------------------------------------------------------------------
【スライド7：中扉（指標の導入）】


----------------------------------------------------------------------
【スライド8：ターゲットエンコーディングの導入目的】
モデルを変えただけでは大きな精度の向上が見られなかったので
つぎは使うデータの改善を行うことにしました。


----------------------------------------------------------------------
【スライド9：TEの実装とリーク対策（★重要）】
そこで導入したのが「ターゲットエンコーディング（TE）」です。
これは、チーム名などの文字情報を、「過去の平均観客数」という数値に変換する手法です。「チームの人気」や「対戦カードの注目度」を数値化してモデルに学習させることで、スコアの上昇につながると思い導入しました。
また、ホームとアウェイの数値を掛け合わせた「big_match」という独自指標も作成しました

-----------------------------------------------------------------------
【スライド10】

ターゲットエンコーディングではリークが起こりやすいのが問題ですがk-foldという検証方法を使用してデータを分割し偏りを減らすことでリークへの対処を行っています
今回はすべてのデータを５分割しその平均で提出データを作成しています


----------------------------------------------------------------------
【スライド11：スコア】
そうしてターゲットエンコーディングを使用した指標の利用や
k-foldを行った結果
スコアは3969から「3432」へと、500以上も大幅に改善しました。


----------------------------------------------------------------------
【スライド12：NHK放映の有無（目的）】


----------------------------------------------------------------------
【スライド13：NHKフラグの実装詳細】
さらに精度を上げる方法として放送しているTV局に目をつけました
放送している局のなかにNHK　総合が入っているとほかの放送局があるときよりも
平均観客数が２倍ほど増えていることがわかりました

このことから新たなフラグとしてNHKの放送局が入っているかどうかを追加しました

----------------------------------------------------------------------
【スライド14：NHKフラグ導入後の結果】
具体的な実装方法です。
df["is_nhk"] = df["tv"].apply(lambda x: 1 if "ＮＨＫ総合" in str(x) else 0)
このコードを追加することでnhk総合が入っている場合には1をそれ以外では0を返している行を追加しました。
これにより放送がある場合は普段より多く客が入るとcatboostが学習して
放送がない場合より人数を多く予想してくれるようになります

----------------------------------------------------------------------
【スライド15：】

このフラグを追加した結果、スコアはさらに改善しました
フラグを追加することでより精密な学習ができるようになったからだと思われます

----------------------------------------------------------------------
【スライド16：最終RMSEの比較】
初期モデルからの変化をご覧ください。
ランダムフォレストを用いた初期のスコア 4260に対し、最終モデルでは3200まで誤差を減らすことができました。

これは、初期モデルと比較して約25％の精度向上にあたります。
順調にスコアを伸ばし、目標とした精度を達成することができました。

----------------------------------------------------------------------
【スライド17：】


----------------------------------------------------------------------
【スライド18：スコアの変化】
最終的なスコアの変化と考察です

----------------------------------------------------------------------
【スライド19：要因分析】
精度向上に最も貢献したのは、やはり「ターゲットエンコーディング」でした。
特徴量重要度を確認しても上位を占めており、チーム名や対戦相手を「数値としての人気度」に置き換えたことが、モデルにとって最も有効な情報だったと言えます。
また、NHKフラグによってデータのブレを抑えられたことも、精度の向上に貢献していると思われます


----------------------------------------------------------------------
【スライド20：考察】
今回の分析を通じて、単に高性能なモデル（CatBoost）を使うだけでなく、データの中身を理解し、複数の特徴量を組み合わせること、なるべく誤差が少なくなるような工夫などが大切だと学びました。